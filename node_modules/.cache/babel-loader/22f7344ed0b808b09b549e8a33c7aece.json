{"remainingRequest":"/Volumes/Workzone/Saber/node_modules/babel-loader/lib/index.js!/Volumes/Workzone/Saber/node_modules/eslint-loader/index.js??ref--13-0!/Volumes/Workzone/Saber/src/store/modules/user.js","dependencies":[{"path":"/Volumes/Workzone/Saber/src/store/modules/user.js","mtime":1590478366889},{"path":"/Volumes/Workzone/Saber/node_modules/cache-loader/dist/cjs.js","mtime":1590478895012},{"path":"/Volumes/Workzone/Saber/node_modules/babel-loader/lib/index.js","mtime":1590478873019},{"path":"/Volumes/Workzone/Saber/node_modules/eslint-loader/index.js","mtime":1590478888364}],"contextDependencies":[],"result":["import _typeof from \"/Volumes/Workzone/Saber/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\nimport \"core-js/modules/web.dom.iterable\";\nimport { setToken, removeToken } from '@/util/auth';\nimport { setStore, getStore } from '@/util/store';\nimport { isURL, validatenull } from '@/util/validate';\nimport { deepClone } from '@/util/util';\nimport webiste from '@/config/website';\nimport { loginByUsername, getUserInfo, getMenu, getTopMenu, logout, refeshToken, getButtons } from '@/api/user';\n\nfunction addPath(ele, first) {\n  var menu = webiste.menu;\n  var propsConfig = menu.props;\n  var propsDefault = {\n    label: propsConfig.label || 'name',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  };\n  var icon = ele[propsDefault.icon];\n  ele[propsDefault.icon] = validatenull(icon) ? menu.iconDefault : icon;\n  var isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\n  if (!isChild) ele[propsDefault.children] = [];\n\n  if (!isChild && first && !isURL(ele[propsDefault.path])) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index';\n  } else {\n    ele[propsDefault.children].forEach(function (child) {\n      addPath(child);\n    });\n  }\n}\n\nvar user = {\n  state: {\n    userInfo: getStore({\n      name: 'userInfo'\n    }) || [],\n    permission: getStore({\n      name: 'permission'\n    }) || {},\n    roles: [],\n    menu: getStore({\n      name: 'menu'\n    }) || [],\n    menuAll: [],\n    token: getStore({\n      name: 'token'\n    }) || ''\n  },\n  actions: {\n    //根据用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve, reject) {\n        loginByUsername(userInfo.tenantId, userInfo.username, userInfo.password, userInfo.type, userInfo.key, userInfo.code).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data.accessToken);\n          commit('SET_USERIFNO', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    GetButtons: function GetButtons(_ref2) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve) {\n        getButtons().then(function (res) {\n          var data = res.data.data;\n          commit('SET_PERMISSION', data);\n          resolve();\n        });\n      });\n    },\n    //根据手机号登录\n    LoginByPhone: function LoginByPhone(_ref3, userInfo) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve) {\n        loginByUsername(userInfo.phone, userInfo.code).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        });\n      });\n    },\n    GetUserInfo: function GetUserInfo(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        getUserInfo().then(function (res) {\n          var data = res.data.data;\n          commit('SET_ROLES', data.roles);\n          resolve(data);\n        }).catch(function (err) {\n          reject(err);\n        });\n      });\n    },\n    //刷新token\n    RefeshToken: function RefeshToken(_ref5) {\n      var state = _ref5.state,\n          commit = _ref5.commit;\n      return new Promise(function (resolve, reject) {\n        refeshToken(state.refeshToken).then(function (res) {\n          var data = res.data.data;\n          commit('SET_TOKEN', data);\n          resolve(data);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref6) {\n      var commit = _ref6.commit;\n      return new Promise(function (resolve, reject) {\n        logout().then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_MENU', []);\n          commit('SET_ROLES', []);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          removeToken();\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //注销session\n    FedLogOut: function FedLogOut(_ref7) {\n      var commit = _ref7.commit;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        commit('SET_MENU', []);\n        commit('SET_ROLES', []);\n        commit('DEL_ALL_TAG');\n        commit('CLEAR_LOCK');\n        removeToken();\n        resolve();\n      });\n    },\n    GetTopMenu: function GetTopMenu() {\n      return new Promise(function (resolve) {\n        getTopMenu().then(function (res) {\n          var data = res.data.data || [];\n          resolve(data);\n        });\n      });\n    },\n    //获取系统菜单\n    GetMenu: function GetMenu(_ref8, parentId) {\n      var commit = _ref8.commit,\n          dispatch = _ref8.dispatch;\n      return new Promise(function (resolve) {\n        getMenu(parentId).then(function (res) {\n          var data = res.data.data;\n          var menu = deepClone(data);\n          menu.forEach(function (ele) {\n            addPath(ele, true);\n          });\n          commit('SET_MENU', menu);\n          dispatch('GetButtons');\n          resolve(menu);\n        });\n      });\n    }\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      setToken(token);\n      state.token = token;\n      setStore({\n        name: 'token',\n        content: state.token,\n        type: 'session'\n      });\n    },\n    SET_USERIFNO: function SET_USERIFNO(state, userInfo) {\n      state.userInfo = userInfo;\n      setStore({\n        name: 'userInfo',\n        content: state.userInfo\n      });\n    },\n    SET_MENU: function SET_MENU(state, menu) {\n      state.menu = menu;\n      setStore({\n        name: 'menu',\n        content: state.menu,\n        type: 'session'\n      });\n    },\n    SET_MENU_ALL: function SET_MENU_ALL(state, menuAll) {\n      state.menuAll = menuAll;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_PERMISSION: function SET_PERMISSION(state, permission) {\n      var result = [];\n\n      function getCode(list) {\n        list.forEach(function (ele) {\n          if (_typeof(ele) === 'object') {\n            var chiildren = ele.children;\n            var code = ele.code;\n\n            if (chiildren) {\n              getCode(chiildren);\n            } else {\n              result.push(code);\n            }\n          }\n        });\n      }\n\n      getCode(permission);\n      state.permission = {};\n      result.forEach(function (ele) {\n        state.permission[ele] = true;\n      });\n      setStore({\n        name: 'permission',\n        content: state.permission,\n        type: 'session'\n      });\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["/Volumes/Workzone/Saber/src/store/modules/user.js"],"names":["setToken","removeToken","setStore","getStore","isURL","validatenull","deepClone","webiste","loginByUsername","getUserInfo","getMenu","getTopMenu","logout","refeshToken","getButtons","addPath","ele","first","menu","propsConfig","props","propsDefault","label","path","icon","children","iconDefault","isChild","length","forEach","child","user","state","userInfo","name","permission","roles","menuAll","token","actions","LoginByUsername","commit","Promise","resolve","reject","tenantId","username","password","type","key","code","then","res","data","accessToken","catch","error","GetButtons","LoginByPhone","phone","GetUserInfo","err","RefeshToken","LogOut","FedLogOut","GetTopMenu","GetMenu","parentId","dispatch","mutations","SET_TOKEN","content","SET_USERIFNO","SET_MENU","SET_MENU_ALL","SET_ROLES","SET_PERMISSION","result","getCode","list","chiildren","push"],"mappings":"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","sourcesContent":["import {setToken, removeToken} from '@/util/auth'\nimport {setStore, getStore} from '@/util/store'\nimport {isURL, validatenull} from '@/util/validate'\nimport {deepClone} from '@/util/util'\nimport webiste from '@/config/website'\nimport {loginByUsername, getUserInfo, getMenu, getTopMenu, logout, refeshToken, getButtons} from '@/api/user'\n\n\nfunction addPath(ele, first) {\n  const menu = webiste.menu;\n  const propsConfig = menu.props;\n  const propsDefault = {\n    label: propsConfig.label || 'name',\n    path: propsConfig.path || 'path',\n    icon: propsConfig.icon || 'icon',\n    children: propsConfig.children || 'children'\n  };\n  const icon = ele[propsDefault.icon];\n  ele[propsDefault.icon] = validatenull(icon) ? menu.iconDefault : icon;\n  const isChild = ele[propsDefault.children] && ele[propsDefault.children].length !== 0;\n  if (!isChild) ele[propsDefault.children] = [];\n  if (!isChild && first && !isURL(ele[propsDefault.path])) {\n    ele[propsDefault.path] = ele[propsDefault.path] + '/index'\n  } else {\n    ele[propsDefault.children].forEach(child => {\n      addPath(child);\n    })\n  }\n\n}\n\nconst user = {\n  state: {\n    userInfo: getStore({name: 'userInfo'}) || [],\n    permission: getStore({name: 'permission'}) || {},\n    roles: [],\n    menu: getStore({name: 'menu'}) || [],\n    menuAll: [],\n    token: getStore({name: 'token'}) || '',\n  },\n  actions: {\n    //根据用户名登录\n    LoginByUsername({commit}, userInfo) {\n      return new Promise((resolve, reject) => {\n        loginByUsername(userInfo.tenantId, userInfo.username, userInfo.password, userInfo.type, userInfo.key, userInfo.code).then(res => {\n          const data = res.data.data;\n          commit('SET_TOKEN', data.accessToken);\n          commit('SET_USERIFNO', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        }).catch(error => {\n          reject(error);\n        })\n      })\n    },\n    GetButtons({commit}) {\n      return new Promise((resolve) => {\n        getButtons().then(res => {\n          const data = res.data.data;\n          commit('SET_PERMISSION', data);\n          resolve();\n        })\n      })\n    },\n    //根据手机号登录\n    LoginByPhone({commit}, userInfo) {\n      return new Promise((resolve) => {\n        loginByUsername(userInfo.phone, userInfo.code).then(res => {\n          const data = res.data.data;\n          commit('SET_TOKEN', data);\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          resolve();\n        })\n      })\n    },\n    GetUserInfo({commit}) {\n      return new Promise((resolve, reject) => {\n        getUserInfo().then((res) => {\n          const data = res.data.data;\n          commit('SET_ROLES', data.roles);\n          resolve(data);\n        }).catch(err => {\n          reject(err);\n        })\n      })\n    },\n    //刷新token\n    RefeshToken({state, commit}) {\n      return new Promise((resolve, reject) => {\n        refeshToken(state.refeshToken).then(res => {\n          const data = res.data.data;\n          commit('SET_TOKEN', data);\n          resolve(data);\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n    // 登出\n    LogOut({commit}) {\n      return new Promise((resolve, reject) => {\n        logout().then(() => {\n          commit('SET_TOKEN', '')\n          commit('SET_MENU', [])\n          commit('SET_ROLES', [])\n          commit('DEL_ALL_TAG');\n          commit('CLEAR_LOCK');\n          removeToken()\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n    //注销session\n    FedLogOut({commit}) {\n      return new Promise(resolve => {\n        commit('SET_TOKEN', '')\n        commit('SET_MENU', [])\n        commit('SET_ROLES', [])\n        commit('DEL_ALL_TAG');\n        commit('CLEAR_LOCK');\n        removeToken()\n        resolve()\n      })\n    },\n    GetTopMenu() {\n      return new Promise(resolve => {\n        getTopMenu().then((res) => {\n          const data = res.data.data || []\n          resolve(data)\n        })\n      })\n    },\n    //获取系统菜单\n    GetMenu({commit, dispatch}, parentId) {\n      return new Promise(resolve => {\n        getMenu(parentId).then((res) => {\n          const data = res.data.data\n          let menu = deepClone(data);\n          menu.forEach(ele => {\n            addPath(ele, true);\n          })\n          commit('SET_MENU', menu)\n          dispatch('GetButtons');\n          resolve(menu)\n        })\n      })\n    },\n  },\n  mutations: {\n    SET_TOKEN: (state, token) => {\n      setToken(token)\n      state.token = token;\n      setStore({name: 'token', content: state.token, type: 'session'})\n    },\n    SET_USERIFNO: (state, userInfo) => {\n      state.userInfo = userInfo;\n      setStore({name: 'userInfo', content: state.userInfo})\n    },\n    SET_MENU: (state, menu) => {\n      state.menu = menu\n      setStore({name: 'menu', content: state.menu, type: 'session'})\n    },\n    SET_MENU_ALL: (state, menuAll) => {\n      state.menuAll = menuAll;\n    },\n    SET_ROLES: (state, roles) => {\n      state.roles = roles;\n    },\n    SET_PERMISSION: (state, permission) => {\n      let result = [];\n\n      function getCode(list) {\n        list.forEach(ele => {\n          if (typeof (ele) === 'object') {\n            const chiildren = ele.children;\n            const code = ele.code;\n            if (chiildren) {\n              getCode(chiildren)\n            } else {\n              result.push(code);\n            }\n          }\n\n        })\n      }\n\n      getCode(permission);\n      state.permission = {};\n      result.forEach(ele => {\n        state.permission[ele] = true;\n      });\n      setStore({name: 'permission', content: state.permission, type: 'session'})\n    }\n  }\n\n}\nexport default user\n"]}]}