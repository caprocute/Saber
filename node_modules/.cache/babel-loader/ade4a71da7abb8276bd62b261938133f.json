{"remainingRequest":"/Volumes/Workzone/Saber/node_modules/babel-loader/lib/index.js!/Volumes/Workzone/Saber/node_modules/eslint-loader/index.js??ref--13-0!/Volumes/Workzone/Saber/src/permission.js","dependencies":[{"path":"/Volumes/Workzone/Saber/src/permission.js","mtime":1590478366886},{"path":"/Volumes/Workzone/Saber/node_modules/cache-loader/dist/cjs.js","mtime":1590478895012},{"path":"/Volumes/Workzone/Saber/node_modules/babel-loader/lib/index.js","mtime":1590478873019},{"path":"/Volumes/Workzone/Saber/node_modules/eslint-loader/index.js","mtime":1590478888364}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\n\n/**\n * 全站权限配置\n *\n */\nimport router from \"./router/router\";\nimport store from \"./store\";\nimport { validatenull } from '@/util/validate';\nimport { getToken } from '@/util/auth';\nimport NProgress from 'nprogress'; // progress bar\n\nimport 'nprogress/nprogress.css'; // progress bar style\n\nNProgress.configure({\n  showSpinner: false\n});\nvar lockPage = store.getters.website.lockPage; //锁屏页\n\nrouter.beforeEach(function (to, from, next) {\n  if (to.matched.length === 0 && to.fullPath.indexOf(\"?sec\") === -1) {\n    next(to.path + \"?sec\");\n    window.location.reload();\n  } else {\n    next();\n  } //缓冲设置\n\n\n  if (to.meta.keepAlive === true && store.state.tags.tagList.some(function (ele) {\n    return ele.value === to.fullPath;\n  })) {\n    to.meta.$keepAlive = true;\n  } else {\n    NProgress.start();\n\n    if (to.meta.keepAlive === true && validatenull(to.meta.$keepAlive)) {\n      to.meta.$keepAlive = true;\n    } else {\n      to.meta.$keepAlive = false;\n    }\n  }\n\n  var meta = to.meta || {};\n\n  if (getToken()) {\n    if (store.getters.isLock && to.path !== lockPage) {\n      //如果系统激活锁屏，全部跳转到锁屏页\n      next({\n        path: lockPage\n      });\n    } else if (to.path === '/login') {\n      //如果登录成功访问登录页跳转到主页\n      next({\n        path: '/'\n      });\n    } else {\n      //如果用户信息为空则获取用户信息，获取用户信息失败，跳转到登录页\n      if (store.getters.token.length === 0) {\n        store.dispatch('FedLogOut').then(function () {\n          next({\n            path: '/login'\n          });\n        });\n      } else {\n        var value = to.query.src || to.fullPath;\n        var label = to.query.name || to.name;\n\n        var _meta = to.meta || router.$avueRouter.meta || {};\n\n        var i18n = to.query.i18n;\n\n        if (_meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\n          store.commit('ADD_TAG', {\n            label: label,\n            value: value,\n            params: to.params,\n            query: to.query,\n            meta: function () {\n              if (!i18n) {\n                return _meta;\n              }\n\n              return {\n                i18n: i18n\n              };\n            }(),\n            group: router.$avueRouter.group || []\n          });\n        }\n\n        next();\n      }\n    }\n  } else {\n    //判断是否需要认证，没有登录访问去登录页\n    if (meta.isAuth === false) {\n      next();\n    } else {\n      next('/login');\n    }\n  }\n});\nrouter.afterEach(function () {\n  NProgress.done();\n  var title = store.getters.tag.label;\n  var i18n = store.getters.tag.meta.i18n;\n  title = router.$avueRouter.generateTitle(title, i18n); //根据当前的标签也获取label的值动态设置浏览器标题\n\n  router.$avueRouter.setTitle(title);\n});",{"version":3,"sources":["/Volumes/Workzone/Saber/src/permission.js"],"names":["router","store","validatenull","getToken","NProgress","configure","showSpinner","lockPage","getters","website","beforeEach","to","from","next","matched","length","fullPath","indexOf","path","window","location","reload","meta","keepAlive","state","tags","tagList","some","ele","value","$keepAlive","start","isLock","token","dispatch","then","query","src","label","name","$avueRouter","i18n","isTab","commit","params","group","isAuth","afterEach","done","title","tag","generateTitle","setTitle"],"mappings":"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","sourcesContent":["/**\n * 全站权限配置\n *\n */\nimport router from './router/router'\nimport store from './store'\nimport {validatenull} from '@/util/validate'\nimport {getToken} from '@/util/auth'\nimport NProgress from 'nprogress' // progress bar\nimport 'nprogress/nprogress.css' // progress bar style\nNProgress.configure({showSpinner: false});\nconst lockPage = store.getters.website.lockPage; //锁屏页\nrouter.beforeEach((to, from, next) => {\n  if (to.matched.length === 0 && to.fullPath.indexOf(\"?sec\") === -1) {\n    next(to.path + \"?sec\");\n    window.location.reload();\n  } else {\n    next();\n  }\n  //缓冲设置\n  if (to.meta.keepAlive === true && store.state.tags.tagList.some(ele => {\n    return ele.value === to.fullPath;\n  })) {\n    to.meta.$keepAlive = true;\n  } else {\n    NProgress.start()\n    if (to.meta.keepAlive === true && validatenull(to.meta.$keepAlive)) {\n      to.meta.$keepAlive = true;\n    } else {\n      to.meta.$keepAlive = false;\n    }\n  }\n  const meta = to.meta || {};\n  if (getToken()) {\n    if (store.getters.isLock && to.path !== lockPage) { //如果系统激活锁屏，全部跳转到锁屏页\n      next({path: lockPage})\n    } else if (to.path === '/login') { //如果登录成功访问登录页跳转到主页\n      next({path: '/'})\n    } else {\n      //如果用户信息为空则获取用户信息，获取用户信息失败，跳转到登录页\n      if (store.getters.token.length === 0) {\n        store.dispatch('FedLogOut').then(() => {\n          next({path: '/login'})\n        })\n      } else {\n        const value = to.query.src || to.fullPath;\n        const label = to.query.name || to.name;\n        const meta = to.meta || router.$avueRouter.meta || {};\n        const i18n = to.query.i18n;\n        if (meta.isTab !== false && !validatenull(value) && !validatenull(label)) {\n          store.commit('ADD_TAG', {\n            label: label,\n            value: value,\n            params: to.params,\n            query: to.query,\n            meta: (() => {\n              if (!i18n) {\n                return meta\n              }\n              return {\n                i18n: i18n\n              }\n            })(),\n            group: router.$avueRouter.group || []\n          });\n        }\n        next()\n      }\n    }\n  } else {\n    //判断是否需要认证，没有登录访问去登录页\n    if (meta.isAuth === false) {\n      next()\n    } else {\n      next('/login')\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  NProgress.done();\n  let title = store.getters.tag.label;\n  let i18n = store.getters.tag.meta.i18n;\n  title = router.$avueRouter.generateTitle(title, i18n)\n  //根据当前的标签也获取label的值动态设置浏览器标题\n  router.$avueRouter.setTitle(title);\n});\n"]}]}